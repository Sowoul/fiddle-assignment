# Use official Node image
FROM node:20-alpine

# Install pnpm globally
RUN corepack enable && corepack prepare pnpm@latest --activate

# Set working directory
WORKDIR /app

# Copy package files separately for better cache
COPY pnpm-lock.yaml ./
COPY package.json ./

# Install dependencies
RUN pnpm install

# Set global bin directory for pnpm
RUN pnpm config set global-bin-dir /usr/local/bin

# Copy the rest of the app
COPY . .

# Build the app (for production)
RUN pnpm build

# Install the 'serve' package globally
RUN pnpm add -g serve

# Expose port
EXPOSE 3000

# Serve the app (for React/Vite)
CMD ["serve", "-s", "dist", "-l", "3000"]
